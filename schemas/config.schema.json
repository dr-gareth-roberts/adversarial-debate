{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/dr-gareth-roberts/adversarial-debate/schemas/config.schema.json",
  "title": "Adversarial Debate Configuration",
  "description": "Configuration schema for adversarial-debate (matches adversarial_debate.config.Config)",
  "type": "object",
  "properties": {
    "provider": {
      "type": "object",
      "description": "LLM provider configuration",
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["anthropic", "openai", "azure", "ollama", "mock"],
          "default": "anthropic",
          "description": "LLM provider to use"
        },
        "api_key": {
          "type": "string",
          "description": "API key for the provider (can also use environment variables)"
        },
        "base_url": {
          "type": "string",
          "format": "uri",
          "description": "Override base URL for the provider API"
        },
        "model": {
          "type": "string",
          "description": "Default model to use"
        },
        "timeout_seconds": {
          "type": "integer",
          "minimum": 1,
          "default": 120,
          "description": "Request timeout in seconds"
        },
        "max_retries": {
          "type": "integer",
          "minimum": 0,
          "default": 3,
          "description": "Maximum retry attempts"
        },
        "temperature": {
          "type": "number",
          "minimum": 0,
          "maximum": 2,
          "default": 0.7,
          "description": "Sampling temperature for model responses"
        },
        "max_tokens": {
          "type": "integer",
          "minimum": 1,
          "maximum": 128000,
          "default": 4096,
          "description": "Maximum tokens in model response"
        },
        "extra": {
          "type": "object",
          "default": {},
          "description": "Provider-specific settings (e.g., Azure deployment / API version)",
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    },
    "logging": {
      "type": "object",
      "description": "Logging configuration",
      "properties": {
        "level": {
          "type": "string",
          "enum": ["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"],
          "default": "INFO",
          "description": "Logging level"
        },
        "format": {
          "type": "string",
          "enum": ["text", "json"],
          "default": "text",
          "description": "Log output format"
        },
        "file_path": {
          "type": "string",
          "description": "Log file path (logs to stderr if not set)",
          "default": null
        },
        "include_timestamps": {
          "type": "boolean",
          "default": true,
          "description": "Include timestamps in logs"
        },
        "include_agent_context": {
          "type": "boolean",
          "default": true,
          "description": "Include agent context in logs"
        }
      },
      "additionalProperties": false
    },
    "sandbox": {
      "type": "object",
      "description": "Sandbox execution configuration",
      "properties": {
        "memory_limit": {
          "type": "string",
          "pattern": "^\\d+[kmgKMG]?$",
          "default": "256m",
          "description": "Memory limit for sandbox container"
        },
        "cpu_limit": {
          "type": "number",
          "exclusiveMinimum": 0,
          "maximum": 16.0,
          "default": 0.5,
          "description": "CPU limit for sandbox container"
        },
        "timeout_seconds": {
          "type": "integer",
          "minimum": 1,
          "maximum": 300,
          "default": 30,
          "description": "Sandbox execution timeout in seconds"
        },
        "max_output_size_bytes": {
          "type": "integer",
          "minimum": 1,
          "default": 1048576,
          "description": "Max captured size per stream (stdout/stderr)"
        },
        "network_enabled": {
          "type": "boolean",
          "default": false,
          "description": "Whether to enable network access in sandbox"
        },
        "allowed_hosts": {
          "type": "array",
          "default": [],
          "description": "Allowlisted hostnames (note: allowlisting is not enforced if network_enabled=true)",
          "items": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9.-]+$"
          }
        },
        "read_only": {
          "type": "boolean",
          "default": true,
          "description": "Use a read-only filesystem where possible"
        },
        "temp_size": {
          "type": "string",
          "pattern": "^\\d+[kmgKMG]?$",
          "default": "64m",
          "description": "Size of the temporary filesystem"
        },
        "use_docker": {
          "type": "boolean",
          "default": true,
          "description": "Use Docker for hardened sandboxing when available"
        },
        "docker_image": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9][a-zA-Z0-9._/-]*:[a-zA-Z0-9._-]+$",
          "default": "python:3.11-slim",
          "description": "Docker image for sandbox execution"
        },
        "use_subprocess": {
          "type": "boolean",
          "default": true,
          "description": "Fallback to subprocess execution if Docker is unavailable"
        },
        "subprocess_timeout": {
          "type": "integer",
          "minimum": 1,
          "maximum": 60,
          "default": 10,
          "description": "Timeout for the subprocess backend in seconds"
        },

        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Legacy alias: if false, disables both use_docker and use_subprocess",
          "deprecated": true
        },
        "timeout": {
          "type": "integer",
          "minimum": 1,
          "maximum": 300,
          "description": "Legacy alias for timeout_seconds",
          "deprecated": true
        },
        "image": {
          "type": "string",
          "description": "Legacy alias for docker_image",
          "deprecated": true
        },
        "memory_limit_mb": {
          "type": "integer",
          "minimum": 0,
          "description": "Legacy alias for memory_limit (in MB)",
          "deprecated": true
        },
        "max_memory_mb": {
          "type": "integer",
          "minimum": 0,
          "description": "Legacy alias for memory_limit (in MB)",
          "deprecated": true
        }
      },
      "additionalProperties": false
    },
    "debug": {
      "type": "boolean",
      "default": false,
      "description": "Enable debug mode"
    },
    "bead_ledger_path": {
      "type": "string",
      "default": "./beads/ledger.jsonl",
      "description": "Path to the bead store ledger file"
    },
    "dry_run": {
      "type": "boolean",
      "default": false,
      "description": "Preview actions without executing"
    },
    "output_dir": {
      "type": "string",
      "default": "./output",
      "description": "Output directory for results"
    }
  },
  "additionalProperties": false
}
